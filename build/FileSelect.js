"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports["default"]=void 0,require("core-js/stable"),require("regenerator-runtime/runtime");function _toConsumableArray(a){return _arrayWithoutHoles(a)||_iterableToArray(a)||_unsupportedIterableToArray(a)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArray(a){if("undefined"!=typeof Symbol&&null!=a[Symbol.iterator]||null!=a["@@iterator"])return Array.from(a)}function _arrayWithoutHoles(a){if(Array.isArray(a))return _arrayLikeToArray(a)}function _typeof(a){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},_typeof(a)}function _getRequireWildcardCache(a){if("function"!=typeof WeakMap)return null;var b=new WeakMap,c=new WeakMap;return(_getRequireWildcardCache=function(a){return a?c:b})(a)}function _interopRequireWildcard(a,b){if(!b&&a&&a.__esModule)return a;if(null===a||"object"!==_typeof(a)&&"function"!=typeof a)return{default:a};var c=_getRequireWildcardCache(b);if(c&&c.has(a))return c.get(a);var d={},e=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var f in a)if("default"!=f&&Object.prototype.hasOwnProperty.call(a,f)){var g=e?Object.getOwnPropertyDescriptor(a,f):null;g&&(g.get||g.set)?Object.defineProperty(d,f,g):d[f]=a[f]}return d["default"]=a,c&&c.set(a,d),d}function _createForOfIteratorHelper(a,b){var c="undefined"!=typeof Symbol&&a[Symbol.iterator]||a["@@iterator"];if(!c){if(Array.isArray(a)||(c=_unsupportedIterableToArray(a))||b&&a&&"number"==typeof a.length){c&&(a=c);var d=0,e=function(){};return{s:e,n:function n(){return d>=a.length?{done:!0}:{done:!1,value:a[d++]}},e:function e(a){throw a},f:e}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var f,g=!0,h=!1;return{s:function s(){c=c.call(a)},n:function n(){var a=c.next();return g=a.done,a},e:function e(a){h=!0,f=a},f:function f(){try{g||null==c["return"]||c["return"]()}finally{if(h)throw f}}}}function _unsupportedIterableToArray(a,b){if(a){if("string"==typeof a)return _arrayLikeToArray(a,b);var c=Object.prototype.toString.call(a).slice(8,-1);return"Object"===c&&a.constructor&&(c=a.constructor.name),"Map"===c||"Set"===c?Array.from(a):"Arguments"===c||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c)?_arrayLikeToArray(a,b):void 0}}function _arrayLikeToArray(a,b){(null==b||b>a.length)&&(b=a.length);for(var c=0,d=Array(b);c<b;c++)d[c]=a[c];return d}function asyncGeneratorStep(a,b,c,d,e,f,g){try{var h=a[f](g),i=h.value}catch(a){return void c(a)}h.done?b(i):Promise.resolve(i).then(d,e)}function _asyncToGenerator(a){return function(){var b=this,c=arguments;return new Promise(function(d,e){function f(a){asyncGeneratorStep(h,d,e,f,g,"next",a)}function g(a){asyncGeneratorStep(h,d,e,f,g,"throw",a)}var h=a.apply(b,c);f(void 0)})}}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),a}var FileSelect=/*#__PURE__*/function(){function a(){var b=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"*",c=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{fileInput:null,onReaderProgress:null,onReadFileComplete:null,onInvalidType:null};_classCallCheck(this,a),this.imageTypes=["image/jpeg","image/png","image/jpg","image/tif","image/tiff","image/gif","image/bmp","image/heif","image/heic"],this.videoTypes=["video/mp4","video/quicktime","video/x-msvideo","ideo/x-flv","video/3gpp","video/MP2T","video/ogg","video/x-m4v"],this.svg={pdf:"<svg focusable=\"false\" data-prefix=\"far\" data-icon=\"file-pdf\" class=\"svg-inline--fa fa-file-pdf fa-w-12\" role=\"img\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 384 512\"><path fill=\"currentColor\" d=\"M369.9 97.9L286 14C277 5 264.8-.1 252.1-.1H48C21.5 0 0 21.5 0 48v416c0 26.5 21.5 48 48 48h288c26.5 0 48-21.5 48-48V131.9c0-12.7-5.1-25-14.1-34zM332.1 128H256V51.9l76.1 76.1zM48 464V48h160v104c0 13.3 10.7 24 24 24h104v288H48zm250.2-143.7c-12.2-12-47-8.7-64.4-6.5-17.2-10.5-28.7-25-36.8-46.3 3.9-16.1 10.1-40.6 5.4-56-4.2-26.2-37.8-23.6-42.6-5.9-4.4 16.1-.4 38.5 7 67.1-10 23.9-24.9 56-35.4 74.4-20 10.3-47 26.2-51 46.2-3.3 15.8 26 55.2 76.1-31.2 22.4-7.4 46.8-16.5 68.4-20.1 18.9 10.2 41 17 55.8 17 25.5 0 28-28.2 17.5-38.7zm-198.1 77.8c5.1-13.7 24.5-29.5 30.4-35-19 30.3-30.4 35.7-30.4 35zm81.6-190.6c7.4 0 6.7 32.1 1.8 40.8-4.4-13.9-4.3-40.8-1.8-40.8zm-24.4 136.6c9.7-16.9 18-37 24.7-54.7 8.3 15.1 18.9 27.2 30.1 35.5-20.8 4.3-38.9 13.1-54.8 19.2zm131.6-5s-5 6-37.3-7.8c35.1-2.6 40.9 5.4 37.3 7.8z\"></path></svg>",text:"<svg aria-hidden=\"true\" focusable=\"false\" data-prefix=\"far\" data-icon=\"file-alt\" class=\"svg-inline--fa fa-file-alt fa-w-12\" role=\"img\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 384 512\"><path fill=\"currentColor\" d=\"M288 248v28c0 6.6-5.4 12-12 12H108c-6.6 0-12-5.4-12-12v-28c0-6.6 5.4-12 12-12h168c6.6 0 12 5.4 12 12zm-12 72H108c-6.6 0-12 5.4-12 12v28c0 6.6 5.4 12 12 12h168c6.6 0 12-5.4 12-12v-28c0-6.6-5.4-12-12-12zm108-188.1V464c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V48C0 21.5 21.5 0 48 0h204.1C264.8 0 277 5.1 286 14.1L369.9 98c9 8.9 14.1 21.2 14.1 33.9zm-128-80V128h76.1L256 51.9zM336 464V176H232c-13.3 0-24-10.7-24-24V48H48v416h288z\"></path></svg>"},this.validateArguments(b,c)}return _createClass(a,[{key:"validateArguments",value:function validateArguments(a,b){var c=b.fileInput;if(c){var d;this.fileInput=c,null!==(d=this.fileInput)&&void 0!==d&&d.tagName||(this.fileInput=document.querySelector(c)||document.querySelector("input[type=file]")||this.createFileInput())}// get allowed types
this.allowedTypes=a?a:"*"}},{key:"createFileInput",value:function createFileInput(){return this.fileInput=document.createElement("input"),this.fileInput.type="file",this.fileInput.id=Date.now(),this.fileInput.style.display="none",this.fileInput.multiple="true",document.body.append(this.fileInput),this.fileInput}},{key:"fileSelected",value:function(){var a=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function a(b){var c,d;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return b.target?(b.stopPropagation(),b.preventDefault(),c=b.target.files[0]):c=b,a.next=3,this.handleFile(c,this.allowedTypes);case 3:if(d=a.sent,!d){a.next=6;break}return a.abrupt("return",!0);case 6:return a.abrupt("return",!0);case 7:case"end":return a.stop();}},a,this)}));return function fileSelected(){return a.apply(this,arguments)}}()/**
     * Select 
     * @returns 
     */},{key:"select",value:function select(){var a=this;return new Promise(function(b,c){a.fileInput||(console.error("Couldn't find file input element."),c(!1)),a.fileInput.onclick=function(a){return a.stopPropagation()},a.fileInput.onchange=function(d){return a.readFiles(d,b,c)},a.fileInput.click()})}},{key:"readFiles",value:function(){var a=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function a(b,c){var d,e,f,g,h,i;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:d=b.target.files,e=[],f=_createForOfIteratorHelper(d),a.prev=3,f.s();case 5:if((g=f.n()).done){a.next=13;break}return h=g.value,a.next=9,this.handleFile(h,this.allowedTypes);case 9:i=a.sent,i&&e.push(i);case 11:a.next=5;break;case 13:a.next=18;break;case 15:a.prev=15,a.t0=a["catch"](3),f.e(a.t0);case 18:return a.prev=18,f.f(),a.finish(18);case 21:;c(e);case 23:case"end":return a.stop();}},a,this,[[3,15,18,21]])}));return function readFiles(){return a.apply(this,arguments)}}()},{key:"uuidv4",value:function uuidv4(){// Unique Id generator for image filename avoids duplicates
//    return ([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g, c =>
//    (c ^ crypto.getRandomValues(new Uint8Array(1))[0] & 15 >> c / 4).toString(16)
//    )
return Date.now()}/**
    * Handle the image.
    * Summary. 
    * 1) Check the file types are valid.
    * 2) Read and return the read file object.
    * @file - the file object to be handled
    * @allowedTypes {array} allowedTypes - file types allowed. Example: [ 'image/jpeg', 'application/pdf' ] 'image/*' allows all image types
    * returns {promise} - a promise  that resolves to the read file object.
    */},{key:"handleFile",value:function handleFile(a,b){var c=this;return new Promise(function(d,e){var f;f=void 0===a.name?c.uuidv4():a.name.replace(/(?=\.[^.]+$)/,"-"+c.uuidv4()),a.uuid=f;var g=c.checkFileTypes(a,b);return g.valid?void// readFile will resolve/recect handleFile, so we pass the resolve argument along.
c.readFile(a,d,e):g})}/**
     * Gets a blob URL for the selected file.
     * If the file is a PDF or a TEXT file, it returns a predetermined svg icon (as a blob url)
     * @param {file object} file  - a selected file from the file input. 
     * @returns blob URL
     */},{key:"getPreview",value:function(){var a=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function a(b){var c,d,e,f,g;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(b){a.next=2;break}throw"Type Error. getPreview expected file object";case 2:if(!b.type.includes("text")){a.next=8;break}return a.next=5,this.createSVGBlob(this.svg.text);case 5:c=a.sent,a.next=15;break;case 8:if(!b.type.includes("heic")){a.next=14;break}return a.next=11,this.getHEICBlob(b);case 11:c=a.sent,a.next=15;break;case 14:c=b;case 15:if(c){a.next=17;break}return a.abrupt("return",null);case 17:if(d=URL.createObjectURL(c),!b.type.includes("pdf")){a.next=25;break}return a.next=21,this.getPDF(d);case 21:return e=a.sent,a.abrupt("return",e);case 25:if(!b.type.includes("video")){a.next=31;break}return f=document.createElement("video"),f.src=d,a.abrupt("return",f);case 31:if(!b.type.includes("image")){a.next=37;break}return g=document.createElement("img"),g.src=d,a.abrupt("return",g);case 37:b.type.includes("text");case 38:case"end":return a.stop();}},a,this)}));return function getPreview(){return a.apply(this,arguments)}}()},{key:"getHEICBlob",value:function(){var a=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function a(b){var c,d,e;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,Promise.resolve().then(function(){return _interopRequireWildcard(require("heic2any"))});case 2:return c=a.sent,d=c["default"],a.next=6,d({blob:b,toType:"image/jpg"}).then(function(a){return a})["catch"](function(){return console.error("Failed to get blob for heic file."),!1});case 6:return e=a.sent,console.log("heic blob",e),a.abrupt("return",e);case 9:case"end":return a.stop();}},a)}));return function getHEICBlob(){return a.apply(this,arguments)}}()},{key:"getPDF",value:function getPDF(a){return new Promise(/*#__PURE__*/function(){var b=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function b(c){var d,e;return regeneratorRuntime.wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return b.next=2,Promise.resolve().then(function(){return _interopRequireWildcard(require("pdfjs-dist/webpack"))});case 2:if(d=b.sent,null!=_typeof(d)){b.next=5;break}throw"couldn't initialize pdf.js library";case 5:e=d.getDocument(a),e.promise.then(function(a){a.getPage(1).then(function(a){var b=a.getViewport({scale:1}),d=document.createElement("canvas");d.style.cssText="\n                        position:relative;\n                        width:100%;\n                        height:auto;\n                        margin:0px auto;\n                        top:50%;\n                        transform: translateY(-50%);";var e=d.getContext("2d");d.height=b.height,d.width=b.width;a.render({canvasContext:e,viewport:b}),c(d)})});case 7:case"end":return b.stop();}},b)}));return function(){return b.apply(this,arguments)}}())}},{key:"createSVGBlob",value:function createSVGBlob(a){return new Promise(function(b){var c=new Blob([a],{type:"image/svg+xml"});b(c)})}},{key:"checkFileTypes",value:function checkFileTypes(a,b){var c=a.type;if("*"===b)return{valid:!0};var d=this.parseTypes(b);return d.types.includes(c)?d.valid=!0:(this.onInvalidType instanceof Function?this.onInvalidType.call(d,d.message):console.error(d.message),d.valid=!1),d}},{key:"parseTypes",value:function parseTypes(a){var b=a.map(function(a){return a}),c=[],d=[],e=b.indexOf("image/*");-1<e&&(c.push.apply(c,_toConsumableArray(this.imageTypes)),b.splice(e,1),d.push("an image"));var f=b.indexOf("video/*");// push remaining types
if(-1<f&&(c.push.apply(c,_toConsumableArray(this.videoTypes)),b.splice(f,1),d.push("a video")),0<b.length){var g,h=_createForOfIteratorHelper(b);try{for(h.s();!(g=h.n()).done;){var j=g.value;c.push(j);var k=j.split("/");d.push(".".concat(k[1]))}}catch(a){h.e(a)}finally{h.f()}}var i=d.reduce(function(a,b,c){return 0==c?a+=b:c==d.length-1?a+=" or ".concat(b):a+=", ".concat(b)},"File type must be ");return{message:i,types:c}}},{key:"readFile",value:function readFile(a,b,c){var d,f=this,g=new FileReader;g.onprogress=function(b){f.progress(b,a)},g.onload=function(a){return function(c){var e=c.target.result;d={name:a.name,type:a.type,size:a.size,uuid:a.uuid,// id : file.id,
data:e},f.readFileComplete(d),b(d)}}(a),g.onerror=function(a){var b;switch(a.target.error.code){case a.target.error.NOT_FOUND_ERR:b="File not found!";break;case a.target.error.NOT_READABLE_ERR:b="File not readable!";break;case a.target.error.ABORT_ERR:b="Read operation was aborted!";break;case a.target.error.SECURITY_ERR:b="File is in a locked state!";break;case a.target.error.ENCODING_ERR:b="The file is too long to encode in a \"data://\" URL.";break;default:b="Read error.";}console.error("Read File Error:",b),c(b)},g.readAsDataURL(a)}},{key:"progress",value:function progress(a,b){this.onReaderProgress instanceof Function&&this.onReaderProgress.call(b,a)}},{key:"readFileComplete",value:function readFileComplete(a){this.onFileReadComplete instanceof Function&&this.onFileReadComplete.call(this,a)}/**
     * 
     * @param {object} icons an object of icon images to be served by getPreview
     * @property {string} icons.pdf 
     * @property {string} icons.text 
     */}]),a}(),_default=FileSelect;exports["default"]=_default;
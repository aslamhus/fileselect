"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports["default"]=void 0,require("core-js/stable"),require("regenerator-runtime/runtime");function _getRequireWildcardCache(a){if("function"!=typeof WeakMap)return null;var b=new WeakMap,c=new WeakMap;return(_getRequireWildcardCache=function(a){return a?c:b})(a)}function _interopRequireWildcard(a,b){if(!b&&a&&a.__esModule)return a;if(null===a||"object"!==_typeof(a)&&"function"!=typeof a)return{default:a};var c=_getRequireWildcardCache(b);if(c&&c.has(a))return c.get(a);var d={},e=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var f in a)if("default"!=f&&Object.prototype.hasOwnProperty.call(a,f)){var g=e?Object.getOwnPropertyDescriptor(a,f):null;g&&(g.get||g.set)?Object.defineProperty(d,f,g):d[f]=a[f]}return d["default"]=a,c&&c.set(a,d),d}function _slicedToArray(a,b){return _arrayWithHoles(a)||_iterableToArrayLimit(a,b)||_unsupportedIterableToArray(a,b)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArrayLimit(a,b){var c=null==a?null:"undefined"!=typeof Symbol&&a[Symbol.iterator]||a["@@iterator"];if(null!=c){var d,e,f=[],g=!0,h=!1;try{for(c=c.call(a);!(g=(d=c.next()).done)&&(f.push(d.value),!(b&&f.length===b));g=!0);}catch(a){h=!0,e=a}finally{try{g||null==c["return"]||c["return"]()}finally{if(h)throw e}}return f}}function _arrayWithHoles(a){if(Array.isArray(a))return a}function _typeof(a){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},_typeof(a)}function _createForOfIteratorHelper(a,b){var c="undefined"!=typeof Symbol&&a[Symbol.iterator]||a["@@iterator"];if(!c){if(Array.isArray(a)||(c=_unsupportedIterableToArray(a))||b&&a&&"number"==typeof a.length){c&&(a=c);var d=0,e=function(){};return{s:e,n:function n(){return d>=a.length?{done:!0}:{done:!1,value:a[d++]}},e:function e(a){throw a},f:e}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var f,g=!0,h=!1;return{s:function s(){c=c.call(a)},n:function n(){var a=c.next();return g=a.done,a},e:function e(a){h=!0,f=a},f:function f(){try{g||null==c["return"]||c["return"]()}finally{if(h)throw f}}}}function _unsupportedIterableToArray(a,b){if(a){if("string"==typeof a)return _arrayLikeToArray(a,b);var c=Object.prototype.toString.call(a).slice(8,-1);return"Object"===c&&a.constructor&&(c=a.constructor.name),"Map"===c||"Set"===c?Array.from(a):"Arguments"===c||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c)?_arrayLikeToArray(a,b):void 0}}function _arrayLikeToArray(a,b){(null==b||b>a.length)&&(b=a.length);for(var c=0,d=Array(b);c<b;c++)d[c]=a[c];return d}function asyncGeneratorStep(a,b,c,d,e,f,g){try{var h=a[f](g),i=h.value}catch(a){return void c(a)}h.done?b(i):Promise.resolve(i).then(d,e)}function _asyncToGenerator(a){return function(){var b=this,c=arguments;return new Promise(function(d,e){function f(a){asyncGeneratorStep(h,d,e,f,g,"next",a)}function g(a){asyncGeneratorStep(h,d,e,f,g,"throw",a)}var h=a.apply(b,c);f(void 0)})}}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),a}var FileSelect=/*#__PURE__*/function(){function a(){var b=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"*",c=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{fileInput:!0,onReaderProgress:null,onReadFileComplete:null,onInvalidType:null,colors:null};_classCallCheck(this,a),this.colors=c.colors||this.themes.greyscale,this.themes={greyscale:{bg:"#CCCCCC",iconBg:"#000000",textBg:"#333333",text:"#FFFFFF"},blue:{bg:"rgba(255, 255, 255, 0)",iconBg:"#2B73BA",textBg:"#00458F",text:"#FFFFFF"},lightBlue:{bg:"rgba(255, 255, 255, 0)",iconBg:"#3dccff",textBg:"#17bcff",text:"#FFFFFF"},red:{bg:"rgba(255, 255, 255, 0)",iconBg:"#be4646",textBg:"#901d1d",text:"#FFFFFF"},green:{bg:"rgba(255, 255, 255, 0)",iconBg:"#1b9362",textBg:"#01613a",text:"#FFFFFF"},purple:{bg:"rgba(255, 255, 255, 0)",iconBg:"#a040b8",textBg:"#73178a",text:"#FFFFFF"},black:{bg:"rgba(255, 255, 255, 0)",iconBg:"#000000",textBg:"#000000",text:"#FFFFFF"},white:{bg:"rgba(255, 255, 255, 0)",iconBg:"#ffffff",textBg:"#ffffff",text:"#000000"}},this.svg={default:"<svg aria-hidden=\"true\" focusable=\"false\" data-prefix=\"far\" data-icon=\"file\" class=\"svg-inline--fa fa-file fa-w-12\" role=\"img\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 384 512\"><path fill=\"currentColor\" d=\"M369.9 97.9L286 14C277 5 264.8-.1 252.1-.1H48C21.5 0 0 21.5 0 48v416c0 26.5 21.5 48 48 48h288c26.5 0 48-21.5 48-48V131.9c0-12.7-5.1-25-14.1-34zM332.1 128H256V51.9l76.1 76.1zM48 464V48h160v104c0 13.3 10.7 24 24 24h104v288H48z\"></path></svg>"},this.validateArguments(b,c)}return _createClass(a,[{key:"validateArguments",value:function validateArguments(a,b){var c=b.fileInput;if(c){var d;this.fileInput=c,null!==(d=this.fileInput)&&void 0!==d&&d.tagName||(this.fileInput=document.querySelector(c)||document.querySelector("input[type=file]")||this.createFileInput())}// get allowed types
this.allowedTypes=a?a:"*"}},{key:"createFileInput",value:function createFileInput(){return this.fileInput=document.createElement("input"),this.fileInput.type="file",this.fileInput.id=Date.now(),this.fileInput.style.display="none",this.fileInput.multiple="true",document.body.append(this.fileInput),this.fileInput}},{key:"fileSelected",value:function(){var a=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function a(b){var c,d;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return b.target?(b.stopPropagation(),b.preventDefault(),c=b.target.files[0]):c=b,a.next=3,this.handleFile(c,this.allowedTypes);case 3:if(d=a.sent,!d){a.next=6;break}return a.abrupt("return",!0);case 6:return a.abrupt("return",!0);case 7:case"end":return a.stop();}},a,this)}));return function fileSelected(){return a.apply(this,arguments)}}()},{key:"select",value:function select(){var a=this;return new Promise(function(b,c){a.fileInput||(console.error("Couldn't find file input element."),c(!1)),a.fileInput.onclick=function(a){return a.stopPropagation()},a.fileInput.onchange=function(a){var c=a.target.files;b(c)},a.fileInput.click()})}},{key:"getFiles",value:function getFiles(){if(!this.fileInput)throw"There are no files to get";return this.fileInput.files}},{key:"readFiles",value:function(){var a=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function a(b){var c,d,e,f,g;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:c=[],d=_createForOfIteratorHelper(b),a.prev=2,d.s();case 4:if((e=d.n()).done){a.next=12;break}return f=e.value,a.next=8,this.handleFile(f,this.allowedTypes);case 8:g=a.sent,g&&c.push(g);case 10:a.next=4;break;case 12:a.next=17;break;case 14:a.prev=14,a.t0=a["catch"](2),d.e(a.t0);case 17:return a.prev=17,d.f(),a.finish(17);case 20:;return a.abrupt("return",c);case 22:case"end":return a.stop();}},a,this,[[2,14,17,20]])}));return function readFiles(){return a.apply(this,arguments)}}()/**
    * Handle the image.
    * Summary. 
    * 1) Add unique filename (re)Check the file types are valid.
    * 2) Read and return a file object with the data:URL.
    * @param {File} file - the file object to be handled. Must be instance of file
    * @param {String | String[]} allowedTypes - file types allowed. Example: [ 'image/jpeg', 'application/pdf' ] 
    * @returns {Promise} - a promise that resolves when the file has been read.
    */},{key:"handleFile",value:function handleFile(a,b){var c=this;return new Promise(function(d,e){"object"===_typeof(a)&&a instanceof File||e("Invalid Argument Exception. Expected instance of file."),a.uuid=void 0===a.name?Date.now():a.name.replace(/(?=\.[^.]+$)/,"-"+Date.now());// check filetype is allowed
var f=c.checkFileTypes(a,c.allowedTypes||b);f.valid||d(f),c.readFile(a,d,e)})}/**
     * Gets a blob URL for the selected file.
     * If the file is a PDF or a TEXT file, it returns a predetermined svg icon (as a blob url)
     * @param {file object} file  - a selected file from the file input. 
     * @returns {Element} an element of the appropriate type (image, video, pdf)
     */},{key:"getPreview",value:function(){var a=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function a(b){var c,d,e,f,g,h,i,j,k,l,m;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(b&&"object"===_typeof(b)&&b instanceof File){a.next=2;break}throw"Type Error. getPreview expected file object";case 2:if(c={preview:null,icon:null},g=b.type.split("/"),h=_slicedToArray(g,2),e=h[0],f=h[1],"image"!=e&&"video"!=e&&"pdf"!=f&&"text/plain"!=b.type){a.next=11;break}d=b,a.next=15;break;case 11:if("image/heic"!=b.type&&"image/heif"!=b.type){a.next=15;break}return a.next=14,this.getHEICBlob(b);case 14:d=a.sent;case 15:d&&(i=URL.createObjectURL(d)),a.t0=e,a.next="application"===a.t0?19:"text"===a.t0?26:"video"===a.t0?37:"image"===a.t0?40:43;break;case 19:if("pdf"!=f){a.next=25;break}return a.next=22,this.getPDF(i);case 22:j=a.sent,a.next=25;break;case 25:return a.abrupt("break",43);case 26:if("plain"!=f){a.next=36;break}return a.next=29,b.text();case 29:k=a.sent,console.log("text",k),j=document.createElement("div"),j.style.padding="15px",j.textContent=k,a.next=36;break;case 36:return a.abrupt("break",43);case 37:return j=document.createElement("video"),j.src=i,a.abrupt("break",43);case 40:return j=document.createElement("img"),j.src=i,a.abrupt("break",43);case 43:if(l=this.getExtensionFromFilename(b.name),void 0===this.svg[b.type]){a.next=50;break}return a.next=47,this.createSVGBlob(this.svg[b.type]);case 47:a.t1=a.sent,a.next=53;break;case 50:return a.next=52,this.createDefaultIcon(l,this.colors);case 52:a.t1=a.sent;case 53:return m=a.t1,c.preview=j,c.icon=m,URL.revokeObjectURL(i),a.abrupt("return",c);case 58:case"end":return a.stop();}},a,this)}));return function getPreview(){return a.apply(this,arguments)}}()},{key:"getExtensionFromFilename",value:function getExtensionFromFilename(a){return console.log("filename",a),a.match(/\.[0-9A-Z]+$/i)}},{key:"getHEICBlob",value:function(){var a=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function a(b){var c,d,e;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,Promise.resolve().then(function(){return _interopRequireWildcard(require("heic2any"))});case 2:return c=a.sent,d=c["default"],a.next=6,d({blob:b,toType:"image/jpg"}).then(function(a){return a})["catch"](function(){return console.error("Failed to get blob for heic file."),!1});case 6:return e=a.sent,console.log("heic blob",e),a.abrupt("return",e);case 9:case"end":return a.stop();}},a)}));return function getHEICBlob(){return a.apply(this,arguments)}}()},{key:"createSVGBlob",value:function createSVGBlob(a){return new Promise(function(b){var c=new Blob([a],{type:"image/svg+xml"});b(c)})}/**
     * Draw an icon 
     * @param {String} ext - the file extension (to be drawn in the icon)
     * @param {Object} colors - color options for the icon
     * @param {String} colors.bg - bg behind icon color
     * @param {String} colors.iconBg - file icon bg color
     * @param {String} colors.textBg - text bg color
     * @param {String} colors.text - text color
     * @returns 
     */},{key:"createDefaultIcon",value:function createDefaultIcon(a,b){var c=this;return new Promise(function(d){b||(b={bg:"#CCCCCC",iconBg:"#000000",textBg:"#333333",text:"#FFFFFF"});var e=c.createCanvas(),f=e.getContext("2d");c.drawBg(e,f,b.bg),c.drawIcon(e,f,b.iconBg),c.drawTextBg(e,f,b.textBg),c.drawText(e,f,a,b.text),d(e)})}},{key:"createCanvas",value:function createCanvas(){var a=document.createElement("canvas");return a.width=384,a.height=512,a.width=a.width,a}},{key:"drawBg",value:function drawBg(a,b,c){b.fillStyle=c,b.fillRect(0,0,a.width,a.height)}},{key:"drawTextBg",value:function drawTextBg(a,b,c){b.fillStyle=c,b.fillRect(72,a.height-190,270,120)}},{key:"drawText",value:function drawText(a,b,c,d){b.fillStyle=d,b.font="70px Arial",b.font="normal normal normal normal 15px/28px 'Helvetica Neue', Helvetica, Arial, sans-serif",b.font="small-caps bold 80px 'HelveticaNeue',Helvetica,Arial,sans-serif",b.textBaseline="middle",b.textAlign="end",b.fillText(c,320,a.height-190+60,240)}},{key:"drawIcon",value:function drawIcon(a,b,c){b.save(),b.strokeStyle="rgba(0,0,0,1)",b.miterLimit=4,b.scale(.75,.75);var d=.75*(a.width-.75*a.width);console.log("x",d);var e=.75*(a.height-.75*a.height);b.translate(d,e),b.scale(1,1),b.save(),b.fillStyle=c||"#000000",b.beginPath(),b.moveTo(224,136),b.lineTo(224,0),b.lineTo(24,0),b.bezierCurveTo(10.7,0,0,10.7,0,24),b.lineTo(0,488),b.bezierCurveTo(0,501.3,10.7,512,24,512),b.lineTo(360,512),b.bezierCurveTo(373.3,512,384,501.3,384,488),b.lineTo(384,160),b.lineTo(248,160),b.bezierCurveTo(234.8,160,224,149.2,224,136),b.closePath(),b.moveTo(384,121.9),b.lineTo(384,128),b.lineTo(256,128),b.lineTo(256,0),b.lineTo(262.1,0),b.bezierCurveTo(268.5,0,274.6,2.5,279.1,7),b.lineTo(377,105),b.bezierCurveTo(381.5,109.5,384,115.6,384,121.9),b.closePath(),b.fill(),b.stroke(),b.restore(),b.restore()}},{key:"draw1",value:function draw1(a,b){a.save(),a.strokeStyle="rgba(50,50,50,1)",a.lineCap="butt",a.lineJoin="miter",a.miterLimit=2,a.save(),a.fillStyle=b||"#000000",a.beginPath(),a.moveTo(369.9,97.9),a.lineTo(286,14),a.bezierCurveTo(277,5,264.8,-.1,252.1,-.1),a.lineTo(48,-.1),a.bezierCurveTo(21.5,0,0,21.5,0,48),a.lineTo(0,464),a.bezierCurveTo(0,490.5,21.5,512,48,512),a.lineTo(336,512),a.bezierCurveTo(362.5,512,384,490.5,384,464),a.lineTo(384,131.9),a.bezierCurveTo(384,119.2,378.9,106.9,369.9,97.9),a.closePath(),a.moveTo(332.1,128),a.lineTo(256,128),a.lineTo(256,51.9),a.lineTo(332.1,128),a.closePath(),a.moveTo(48,464),a.lineTo(48,48),a.lineTo(208,48),a.lineTo(208,152),a.bezierCurveTo(208,165.3,218.7,176,232,176),a.lineTo(336,176),a.lineTo(336,464),a.lineTo(48,464),a.closePath(),a.fill(),a.stroke(),a.restore(),a.restore()}},{key:"getPDF",value:function getPDF(a){return new Promise(/*#__PURE__*/function(){var b=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function b(c){var d,e;return regeneratorRuntime.wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return b.next=2,Promise.resolve().then(function(){return _interopRequireWildcard(require("pdfjs-dist/webpack"))});case 2:if(d=b.sent,null!=_typeof(d)){b.next=5;break}throw"couldn't initialize pdf.js library";case 5:e=d.getDocument(a),e.promise.then(function(a){a.getPage(1).then(function(a){var b=a.getViewport({scale:1}),d=document.createElement("canvas");d.style.cssText="\n                        position:relative;\n                        width:100%;\n                        height:auto;\n                        margin:0px auto;\n                        top:50%;\n                        transform: translateY(-50%);";var e=d.getContext("2d");d.height=b.height,d.width=b.width;a.render({canvasContext:e,viewport:b}),c(d)})});case 7:case"end":return b.stop();}},b)}));return function(){return b.apply(this,arguments)}}())}},{key:"checkFileTypes",value:function checkFileTypes(a,b){var c=a.type;if("*"===b)return{valid:!0};var d,e,f=this.getTypeList(b||this.allowedTypes),g=c.split("/"),h=_slicedToArray(g,2);return(d=h[0],e=h[1],f.types.includes("".concat(d,"/*")))?{valid:!0}:(f.types.includes(c)?f.valid=!0:(f.valid=!1,this.onInvalidType instanceof Function?this.onInvalidType.call(f,f.message):console.error(f.message)),f)}},{key:"getTypeList",value:function getTypeList(a){"string"==typeof a&&(a=[a]);var b=a.map(function(a){return a}),c=[],d=[];// push remaining types
if(0<b.length){var e,f=_createForOfIteratorHelper(b);try{for(f.s();!(e=f.n()).done;){var h=e.value;c.push(h);var i=h.split("/");d.push(".".concat(i[1]))}}catch(a){f.e(a)}finally{f.f()}}var g=d.reduce(function(a,b,c){return 0==c?a+=b:c==d.length-1?a+=" or ".concat(b):a+=", ".concat(b)},"File type must be ");return{message:g,types:c}}},{key:"readFile",value:function readFile(a,b,c){var d,f=this,g=new FileReader;g.onprogress=function(b){f.progress(b,a)},g.onload=function(a){return function(c){var e=c.target.result;d={name:a.name,type:a.type,size:a.size,uuid:a.uuid,data:e},f.readFileComplete(d),b(d)}}(a),g.onerror=function(a){var b;switch(a.target.error.code){case a.target.error.NOT_FOUND_ERR:b="File not found!";break;case a.target.error.NOT_READABLE_ERR:b="File not readable!";break;case a.target.error.ABORT_ERR:b="Read operation was aborted!";break;case a.target.error.SECURITY_ERR:b="File is in a locked state!";break;case a.target.error.ENCODING_ERR:b="The file is too long to encode in a \"data://\" URL.";break;default:b="Read error.";}console.error("Read File Error:",b),c(b)},g.readAsDataURL(a)}},{key:"progress",value:function progress(a,b){this.onReaderProgress instanceof Function&&this.onReaderProgress.call(b,a)}},{key:"readFileComplete",value:function readFileComplete(a){this.onFileReadComplete instanceof Function&&this.onFileReadComplete.call(this,a)}}]),a}(),_default=FileSelect;exports["default"]=_default;
